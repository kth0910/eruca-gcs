name: Docs â€“ build & deploy

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write    # <-- ë°˜ë“œì‹œ ìžˆì–´ì•¼ deploy-pagesê°€ ê¶Œí•œì„ ì–»ìŒ
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages            # Pages ê¸°ë³¸ í™˜ê²½
      url:  ${{ steps.deploy.outputs.page_url }}

    steps:
    # 1) ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
    - uses: actions/checkout@v3

    # 2) Pages ëŸ°íƒ€ìž„ ì´ˆê¸°í™”  (ðŸ’¡ í•­ìƒ â€œê°€ìž¥ ë¨¼ì €â€)
    - uses: actions/configure-pages@v4

    # 3) Ruby + ë²ˆë“¤ ìºì‹œ
    - uses: ruby/setup-ruby@v1
      with:
        ruby-version: 3.1
        bundler-cache: true        # Gemfile.lock í™œìš©

    # 4) Jekyll ë¹Œë“œ
    - name: Build Jekyll site
      run: |
        cd docs
        bundle install
        bundle exec jekyll build -d ../_site   # ê²°ê³¼ë¥¼ ì›Œí¬ìŠ¤íŽ˜ì´ìŠ¤ ë£¨íŠ¸ì˜ _site ë¡œ

    # 5) Pages ì „ìš© ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ  (v3 â†’ ë‚´ë¶€ì ìœ¼ë¡œ upload-artifact@v4 ì‚¬ìš©)
    - uses: actions/upload-pages-artifact@v3
      with:
        path: ./_site              # â† â€œ./â€ í¬í•¨, ì´ë¦„ì€ ê¸°ë³¸ê°’ github-pages

    # 6) ì‹¤ì œ ë°°í¬
    - id: deploy
      uses: actions/deploy-pages@v2
